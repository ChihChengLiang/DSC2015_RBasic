---
title: R Basic
author: "Ning Chen"
date: '`r Sys.Date()`<br><br><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="創用 CC 授權條款" style="border-width:0" src="img/by-nc-sa-4.0-88x31.png" /></a>'
output:
  ioslides_presentation:
    theme: default
    highlight: default
    logo: img/Taiwan-R-logo.png
    widescreen: true
    number_section: true
subtitle: R 101

---

<style>
.reveal pre code {
  background:white;
  color: black;
}

.reveal pre code span {
  color: black;
  font-weight: normal;
}

.variable{
  color: gray;
}

div.hidecode + pre + pre {display: none}
</style>
<script>
doclick=function(e){
  var elem = e.nextSibling.nextSibling.nextSibling.nextSibling;
  if(elem.style.display=="none"){
    elem.style.display="block";
  }else{
    elem.style.display="none";
  }
}
</script>

<style>
h2 {
  font-size: 40px;
  color: blue;
}
span {
  font-size: 20px;
}
</style>



## R: A Brief Introduction

- 1976 貝爾實驗室 John Chambers,Rick Becker,Allan Wilks 研發 S 語言
- 1993 Ross Ihaka and Robert Gentlemen (University of Auckland, New Zealand) 研發 R 語言  
- R 語言是一種基於 S 語言所發展出具備統計分析, 繪圖與資料視覺化的程式語言  
- 1997 R 的核心開發團隊 (R development core team) 成立, 專責 R 原始碼的修改與編寫 

---

[Companies Using R](http://www.revolutionanalytics.com/companies-using-r)

<iframe src="http://www.revolutionanalytics.com/companies-using-r" align='middle'></iframe>

---

讓我們用R先來玩個資料吧～～

![USALandCollect](img/Boston.png)

---

- 你沒看錯，今天其實是投資說明會，教你買地!
- R 有很多套件，裡面會有很多內建的資料集可以使用。
- 這次我們要使用的是 `MASS` 這個套件中的 `Boston` 資料集。

---


```{r,eval=TRUE}
library(MASS)
#介紹引入套件
data(Boston)
Boston=subset(Boston,,-c(zn,chas,black,rad,ptratio,age,nox,tax))
#刪減欄位
```
<br>
<br>
<br>
<br>  
<div class="variable">
* 引入套件  
    + library(套件名稱)  
* 引入套件中的資料集  
    + data(資料集名稱) 

</div>

---

## 如何看資料

- `head` 會列出前 6 筆資料。

<div class="hidecode" onclick="doclick(this);">[Show]</div>
```{r}
head(Boston)
```



---

## Boston Dataset有哪些Variables

Column Name | 中文 | Column Name | 中文
- | - | - | -
crim | 犯罪率 | rm | 該鎮平均每戶的房間數目
dis | 離公司距離 | indus | 商業區比例
lstat | lower status of the population (percent).低收入戶比例 | medv | 自有住宅房價中位數


---

你也可以使用head(),  tail(),  summary(),  str()


---





## 如何看資料- 好用的summary()

```{r}
summary(Boston)
```


---

Column Name | 中文 | Column Name | 中文
- | - | - | -
crim | 犯罪率 | indus | 商業區率

<bar>
<div class="hidecode" onclick="doclick(this);">[Show]</div>
```{r,echo=FALSE}
library(knitr)
kable(summary(Boston[,c("crim", "indus")]))
```


犯罪率88.9%??


---

Column Name | 中文 | Column Name | 中文
- | - | - | -
rm | 該鎮平均每戶的房間數目 | dis | 離公司距離

<bar>
<div class="hidecode" onclick="doclick(this);">[Show]</div>
```{r,echo=FALSE}

kable(summary(Boston[,c("rm", "dis")]))
```

---

Column Name | 中文 | Column Name | 中文
- | - | - | -
lstat | 低收入戶比例 | medv | 自有住宅房價中位數

<bar>
<div class="hidecode" onclick="doclick(this);">[Show]</div>
```{r,echo=FALSE}

kable(summary(Boston[,c("lstat", "medv")]))
```

---

哪些因素(欄位)影響房價??

---

## 尋找相關性 cor()
```{r}
#解釋1非常正相關 -1是非常負相關
cor(Boston$medv,Boston)
```
<br>
<br>
<br>
<div class="variable">
關聯性
cor(x, y)
</div>

---

你用圖來看各欄位跟房價之間的關聯度

```{r}
barplot(cor(Boston$medv,Boston))

```
<br>
<br>
<br>
<div class="variable">
長條圖
barplot()
</div>


---

####我們可以知道...

房價與房間數是正相關,與低收入戶比例負相關

---

房間數跟房價關係

```{r, echo=FALSE}

plot(Boston$rm,Boston$medv)
#x軸為房間數 y軸為房價
LM=lm(Boston$medv~Boston$rm)
#找出線性關係
abline(LM,col=2)
#畫出圖

```
<br>
<br>
<br>
<div class="variable">
畫圖 
plot(x,y)

線性模型(二元一次方程式,線性迴歸....)
lm(y~x)

在plot上加直線
abline(x,col=)
</div>





---


### 小練習 房間數與房價的關係


---

###  現在我們知道

- 相關性 cor() -> 房價跟房間數正相關,低收入戶多寡負相關
- plot(), barplot() -> 我們還會畫圖

---

---

## 都能出國買房,買地要買就是要買最好的 最貴的


---

### 我要怎定義豪宅

找出前 5% (10%) 的房價

```{r}
quantile(Boston$medv, probs = c(0.95, 0.9))
```
<br>
<br>
<br>
<div class="variable">
百分位數點
quantile(x, probs=)
</div>



---

#### 房價分布圖

- 使用 `hist` 做出房價的柱狀圖。

```{r}
hist(Boston$medv,breaks=20)
```
<br>
<br>
<br>
<div class="variable">
柱狀圖
hist(x,breaks= )
breaks:分成幾類

</div>


---

#### 房價分布圖

- 使用 `hist` 做出房價的柱狀圖。
- 使用 `abline` 標示出剛剛計算的前 5% 高的房價位置。

```{r}
hist(Boston$medv, breaks = 20)
abline(v = 43.4, col="red")
```
<br>
<br>
<br>
<div class="variable">
柱狀圖
hist(x,breaks= )
breaks:分成幾類

在plot上加直線
abline(x,col=)
</div>
---

#### 高房價與其他是否有差異

- 前 5% 的房子的各項平均與其他房子是否有差異?
- 用 R 簡單計算來看看!

---

##### 平均-高房價與其他是否有差異

- 使用 `subset` 做分群。

```{r}
MEDVhight = subset(Boston,Boston$medv>=43.4)
MEDVOther = subset(Boston,Boston$medv< 43.4)
# MEDVhight 為房價高的資料
# MEDVOther 其他資料
```
<br>
<br>
<br>
<div class="variable">
選取資料
subset(x,condition)
</div>
---

##### 平均-高房價與其他是否有差異

- 使用 `colMeans` 計算各欄位平均。

```{r}
colMeans(MEDVhight)
```

```{r}
colMeans(MEDVOther)
```
<br>
<br>
<br>
<div class="variable">
欄平均
colMeans()
</div>
---

- 使用 `rbind` 合併資料表。

```{r}
rbind(colMeans(MEDVhight),colMeans(MEDVOther))
```

高房價區 犯罪率較低 工業區較少 住宅區比例高
<br>
<br>
<br>
<div class="variable">
Row Bind
rbind(row1,row2)
</div>


---

#### 我們現在知道～～

1. 平均數 rbind->富裕區 犯罪率較低 工業區較少 住宅區比例高
2. 相關性 -> 房價跟房間數正相關,低收入戶多寡負相關   
  

---

#### 我們現在知道～～

1. 平均數 rbind->富裕區 犯罪率較低 工業區較少 住宅區比例高
2. 相關性 -> 房價跟房間數正相關,低收入戶多寡負相關   
  

---


## 高房價區 低收入戶多寡分佈

我們可以嘗試將低收入戶分類

<div class="hidecode" onclick="doclick(this);">[Show]</div>
```{r}
Boston2=Boston
Boston2$Income=cut(Boston2$lstat,breaks=3)
#將低收入戶比例分成三區
Boston2$Income
```

---

也許用文字來看更清楚

<div class="hidecode" onclick="doclick(this);">[Show]</div>
```{r}
Boston2$Income= cut(Boston2$lstat,breaks=3,labels=c("H","M","L"))
MEDVhight2 = subset(Boston2,Boston$medv>=43.4)
MEDVhight2$Income
```

---

我可以計算有多少"H"嗎?

<div class="hidecode" onclick="doclick(this);">[Show]</div>
```{r}
table(MEDVhight2$Income)
```


---

# take a rest



---

## 我們來回顧剛剛研究的dataset

```{r}
str(Boston2)
```


---

# R 與資料測量尺度

---

統計上資料測量的尺度分為以下幾種:

- 名目資料(nomial)
- 順序資料(ordinal)
- 區間資料(interval)
- 比例資料(ratio)

---

| 資料衡量尺度 | 變數形態 |   特性   |     範例     |
|--------------|----------|----------|--------------|
|   名目資料   |   質性   |   類別   | 性別、縣市、國家 |
|   順序資料   |   質性   | 優先順序 |     名次     |
|   區間資料   |   量性   | 大小距離 |  溫度、時間  |
|   比例資料   |   量性   |   比值   |  營收、GDP   |

## 名目資料

- 數值只用於記號，**"值"**毫無意義的數據  
    - 性別
    - 國家/班級

| 男 | 女 |
|----|----|
| 0  |  1 |

|男 | 女 |
|---|----|
| 1 | 2  |

## 順序資料

- 數值有順序關係，但是差距沒有意義  
    - 名次  
    - 排序表  

第一名的成績一定比第二名好, 但不代表第一名比第二名好兩倍


## 區間資料

- 有差距的概念，沒有倍數的概念。  
- 數值有1的概念，沒有0的概念。可加減。  
    - 溫度  
    - 時間

## 比值資料

- 同時有差距和倍數的概念。 
- 可加減乘除。 
    - 使用者人數  
    - 營收

# R 的基本資料結構

---

R 的基本資料結構與剛剛所提到的測量尺度有密切的關係

---

R 的基本資料結構與剛剛所提到的測量尺度有密切的關係

| 測量尺度 | 變數形態 | 資料結構 |
|----------|----------|----------|
| 名目資料 |   質性   |  Factor  |
| 順序資料 |   質性   |  Factor  |
| 區間資料 |   量性   |  Vector  |
| 比例資料 |   量性   |  Vector  |

## Vector in R

<div align='center'>
  <img src=img/Vector.png width=70%/>
</div>


## Vector in R

<div align='center'>
  <img src=img/Vector.png width=70%/>
</div>
<br/>

- 可以使用 `c` 這個內建函數建立向量

```{r, cache=TRUE}
x = c(1, 2)
```


## 範例: 12月份 

```{r vector, cache=TRUE}
Month1=c(1,2,3,4,5,6,7,8,9,10,11,12)
Month2=1:12 # 建立連續向量的簡易寫法
```


## 練習一下

- 用剛剛學會的 `c` 來建立兩個向量, `taipei_temp` 跟 `hengchun_temp` 紀錄兩地氣溫。

台北恆春每月平均溫度

|月份|   1  |   2  |   3  |   4  |   5  |   6  |   7  |   8  |   9  |  10  |  11  |  12  |
|----|------|------|------|------|------|------|------|------|------|------|------|------| 
|台北| 16.1 | 16.5 | 18.5 | 21.9 | 25.2 |	27.7 | 29.6 |	29.2 | 27.4 | 24.5 | 21.5 |	17.9 |
|恆春| 20.7 | 21.4 | 23.2 |	25.2 | 27.0 |	27.9 | 28.4 |	28.1 | 27.4 |	26.3 | 24.3 |	21.7 |

## 練習一下

```{r Temperature, cache=TRUE}
taipei_temp = c(16.1, 16.5, 18.5, 21.9,	25.2, 27.7,	29.6,	29.2, 27.4, 
            24.5, 21.5,	17.9)
hengchun_temp = c(20.7, 21.4, 23.2, 25.2,	27.0,	27.9,	28.4,	28.1,	27.4,	
              26.3,	24.3,	21.7)
```

---

- 加上月份名

```{r, cache=TRUE, results='hold'}
names(taipei_temp) = Month1
names(hengchun_temp) = Month2
taipei_temp
hengchun_temp
```


## Element-by-Element Operation

```{r, cache=TRUE, results='hold'}
c(1, 2, 3) + c(3, 2, 1)
```


## Element-by-Element Operation

```{r, cache=TRUE, results='hold'}
c(1, 2, 3) + 1
```

## Element-by-Element Operation

```{r, cache=TRUE, results='hold'}
c(1, 2, 3) + 1
```

![vectorize-plus-before](img/vectorize-plus-before.png)

## Element-by-Element Operation

```{r, cache=TRUE, results='hold'}
c(1, 2, 3) + 1
```

![vectorize-plus-before](img/vectorize-plus-before.png)
![vectorize-plus-after](img/vectorize-plus-after.png)

## 猜猜看

```{r, cache=TRUE, results='hide'}
guess <- c(1:10) + c(1:2)
```

- `guess` 會是多少呢?

## 猜猜看

```{r, cache=TRUE, results='hide'}
guess <- c(1:10) + c(2, 4)
```

- `guess` 會是多少呢?

```{r, results='hold'}
guess
```


## 練習看看

```{r, echo=TRUE, cache=TRUE}
1:3 * 2
```

## 向量的同質性

Character > Numeric > Integer > Logical

```{r, cache=TRUE}
x <- c(1, 2, "3")
class(x)
x
```

## 向量的同質性

Character > Numeric  > Logical

```{r, cache=TRUE}
x <- c(1, 2, "3")
class(x)
x
```

- 向量中的所有元素都必須是同一種型別。


---

R 的基本資料結構與剛剛所提到的測量尺度有密切的關係

| 測量尺度 | 變數形態 | 資料結構 |
|----------|----------|----------|
| 名目資料 |   質性   |  Factor  |
| 順序資料 |   質性   |  Factor  |
| 區間資料 |   量性   |  Vector  |
| 比例資料 |   量性   |  Vector  |


---



## Factor(常用於處理質性)

如何處理名目變數?
```{r factor and Vector}
x <- c("F","M","F","F")
x
x <- factor(c("F","M","F","F"), levels=c("F","M"))
x
as.integer(x)
```

---

```{r factor NA Message}
levels(x)
x <- factor(c("F","M","F","F"), levels=c("F"))
levels(x)
```

---

### 如何處理順序資料?

```{r factor-levels ordinal}
#農業社會 男尊女卑
Argri <- factor(c("F","M","F","F"),order=TRUE,levels=c("F","M"))

#阿美族 女尊男卑
Amis <- factor(c("F","M","F","F"),order=FALSE,levels=c("F","M"))

#應該要用
Amis <- factor(c("F","M","F","F"),order=TRUE,levels=c("M","F"))
```


---

```{r}
#舉一個認真的例子 - 班上一號到六號分別拿到A,B,C的級別
rank=factor(c("C","A","B","B","C","C"),order=TRUE,level=c("C","B","A"))
rank
rank[1]<rank[2]

```


---

Recape


  |"資料衡量尺度" |"變數形態"|"特性"
 - |- |- |-
 1|"名目資料"|"質化"|"類別"
 2|"順序資料"|"質化"|"優先順序"
 3|"區間資料"|"量化"|"大小距離"
 4|"比例資料"|"量化"|"比值"


---

## 

---

### Vector 向量式資料結構

---

### 異質性資料 List 

```{r}
x<-list(1L,2,"3")
```
*連函數都吃
```{r}
x<-list(1L,2,"3",mean)
```

---

### 異質性資料 dataframe

View(Boston)
str(Boston)

---

#### Ways to add a column

Boston$Income<-  
Boston[["Income"]]<-  

---

#### Ways to remove the column

Boston$Income<-NULL
Boston[["Income"]]<-NULL

---

#### subset

rbind

```{r,warning=FALSE}
Serial=c(1,2,3)
RBasicTeacher=c("Dboy", "Ning", "Noha")
RBasicRbind=rbind(Serial,RBasicTeacher)
```

---

cbind
```{r}
Serial=c(1,2,3)
RBasicTeacher=c("Dboy", "Ning", "Noha")
RBasicCbind=cbind(Serial,RBasicTeacher)
RBasic=cbind(c(1,2,3),c("Dboy", "Ning", "Noha"))
```

---

### Merge  

```{r}
PageView <- read.table(header=TRUE, text='
     Date       PageView Rating
           7/1      1231     6.7
           7/2      5423    4.5
           7/3      3219    3.7
           7/4       998    3.3
           7/5       3241    4.1
           7/6       1223    5.2')
Promotion <- read.table(header=TRUE, text='
     Date       Promotion 
           7/1      N
           7/2      Y
           7/3      Y
           7/4      N
           7/5      Y
           7/6      N   ')

merge(PageView,Promotion,"Date")
```

---

### 轉換資料結構 

`as`

- `as.character`
- `as.logical`
- `as.integer`
- `as.numeric`

---

```{r as}
as.numeric("2")
as.integer("a")
```

```{r as.character, echo = TRUE}
x <- c(1, 2, 3, 2, 3, 2, 1)
as.character(x) # 字串
factor(x) # ??用剛才dataframe作
```

---

### 直接轉換

```{r as.numeric, echo = TRUE}
x <- c("1", "2", "3", "2", "a")
as.numeric(x)
```

- `NA`代表Not available，代表著**missing value**

---

## 資料形態的轉換 - 資料清理

---

### 民國80年至82年的國民生產毛額


百萬元
5,023,763
5,614,679
6,205,338


```{r gdp1, echo = TRUE}
gdp <- c("5,023,763", "5,614,679", "6,205,338")
as.numeric(gsub(",", "", gdp))
```

---

## summary 指令

- 根據資料形態的不同，函數的輸出結果也會不同

---

### Factor

```{r}
factor_example=factor(c("三年甲班", "三年乙班", "三年甲班"))
summary(factor_example)
```
三年乙班 三年甲班 
1        2 

---

### Character

```{r}
character_example=c("a","b","c")
summary(character_example)
```
Length     Class      Mode 
3       character   character 

---

### List

```{r}
list_example <- list(1L, 2.0, "3")
summary(list_example)
```
Length Class  Mode     
[1,] 1      -none- numeric  
[2,] 1      -none- numeric  
[3,] 1      -none- character

---

### DataFreame

```{r}
library(MASS)
data(Boston)
summary(Boston)
```

---

## 資料的選取

### 向量的選取

---

#### 坐標

```{r index, echo = TRUE}
x <- 1:5
x[2:3]
```

---

### 布林

```{r boolean_selection, echo = TRUE}
x <- 1:5
x > 3
x[x > 3]
```

## 練習一下

台北恆春每月平均溫度

月份 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 
- |- | - | - | - | - | - | - | - | - | - | - | - 
台北 | 16.1 | 16.5 |  18.5 |  21.9 |  25.2 |	27.7 |	29.6 |	29.2 |	27.4 | 24.5 |	21.5 |	17.9
恆春 | 20.7 | 21.4 | 23.2 |	25.2 |	27.0 |	27.9 |	28.4 |	28.1 |	27.4 |	26.3 |	24.3 |	21.7

---

```{r Temp}
TaipeiTem=c(16.1,16.5,18.5 ,	21.9 ,	25.2 ,	27.7 ,	29.6 ,	29.2,27.4,24.5 ,	21.5 ,	17.9)
HengchunTem=c(20.7 , 21.4 , 23.2 ,  25.2 ,	27.0 ,	27.9 ,	28.4 ,	28.1 ,	27.4 ,	26.3 ,	24.3 ,	21.7)
```



---

## 小挑戰選取台北恆春天氣資料
先印出台北跟恆春每個月平均溫度
```{r}
TaipeiTem
HengchunTem
```

---

# 分別選取出兩地溫度>20度的月份

- "> <"
```{r}
TaipeiTem>20
TaipeiHotMonths = TaipeiTem[TaipeiTem>20]
```
- True & False
```{r}
SelectMonth= HengchunTem>20
HengchunHotMonths = HengchunTem[SelectMonth==TRUE]
```

---

- 找出夏天(七八九月)平均溫度
    ```{r}
 TaipeiTem[7:9]
mean(TaipeiTem[7:9])
HengchunTem[7:9]
mean(HengchunTem[7:9])
    ```

---

- 找出冬天(十二,一,二月)平均溫度
```{r,error=FALSE}
# TaipeiTem[1,2,12]

mean(TaipeiTem[c(1,2,12)])
mean(HengchunTem[c(1,2,12)])
```

---

## 表格的選取

```{r select_table, echo = TRUE}
TemTable=rbind(TaipeiTem,HengchunTem)
TemTable
#選取台北二月的溫度
TemTable[1,2]
#選取二月的溫度
TemTable[,2]
TemTable[1,]

```

---

## 欄的選取

```{r select_column, echo = TRUE}
head(Boston)
head(Boston[["crim"]]) # head(Boston$crim)
```

---

## 探索一個變數

### 量化數據

- 敘述統計量：`mean`、`sd`、`median`、`quantile`

### 質化數據

- 分佈表格：`table`

---

<img width=50% height=50% src=img/Boston.png></img>


# Chapter 1 買地指南

---

- 你沒看錯，今天其實是投資說明會，教你買地!

---

- 你沒看錯，今天其實是投資說明會，教你買地!
- 開玩笑的，等等我們會用 R 來根據資料分析一下，看看怎樣的地才是好地 (地價高) 呢?


## 內建資料

- R 有很多套件，裡面會有很多內建的資料集可以使用。


## 內建資料

- R 有很多套件，裡面會有很多內建的資料集可以使用。
- 這次我們要使用的是 `MASS` 這個套件中的 `Boston` 資料集。

## 內建資料

- R 有很多套件，裡面會有很多內建的資料集可以使用。
- 這次我們要使用的是 `MASS` 這個套件中的 `Boston` 資料集。
- 首先，用 `library` 這個指令匯入套件。

```{r}
library("MASS")
```

---

### 匯入資料集

- 使用 `data` 匯入 `Boston` 資料集

```{r, cache=TRUE}
data(Boston)
```

---

### 查看資料

- `head` 會列出"頭" 6 筆資料。

```{r, cache=TRUE}
head(Boston)
```

---

 Item |    說明    | Item | 說明
------|------------|------|-----
 crim |   犯罪率   |  dis | weighted mean of distances to five Boston employment centres距離上班商業中心地點的英哩數
  zn  | 住宅區比例 |  rad | index of accessibility to radial highways.可到最近的主要高速公路網路的便利指標
indus | 工業區比例 | Tax | full-value property-tax rate per \$10,000.房屋與土地相關的 Tax 比例

---

 Item |              說明            |   Item  | 說明
------|------------------------------|---------|-----
 chas | Charles River dummy variable | ptratio | pupil-teacher ratio by town 平均學生vs教師比例
  nox | 空氣中的一氧化氮比例(ppm) nitrogen oxides concentration (parts per 10 million) | black | 1000(Bk - 0.63)^2 where Bk is the proportion of blacks by town 非洲裔人口比例
Rooms |       平均每戶的房間數目     |  lsta t | lower status of the population (percent).低收入戶比例
 age  | proportion of owner-occupied units built prior to 1940.1940年前所建的自宅比例 | medv | median value of owner-occupied homes in $1000s.自有住宅房價中位數

---

### 定義問題

在開始分析前，好好定義問題有助於製作正確的分析結果。

---

### 定義問題

在開始分析前，好好定義問題有助於製作正確的分析結果。

我們的問題是: 找出資料中高房價的房子所共有的特徵。

---

### 定義問題

在開始分析前，好好定義問題有助於製作正確的分析結果。

我們的問題是: 找出資料中高房價的房子所共有的特徵。

- 什麼是高房價?

---

### 定義問題

在開始分析前，好好定義問題有助於製作正確的分析結果。

我們的問題是: 找出資料中高房價的房子所共有的特徵。

- 什麼是高房價?
    - 前 5% 高的房子

---

### 定義問題

在開始分析前，好好定義問題有助於製作正確的分析結果。

我們的問題是: 找出資料中高房價的房子所共有的特徵。

- 什麼是高房價?
    - 前 5% 高的房子
- 什麼又是特徵呢?

---

### 定義問題

在開始分析前，好好定義問題有助於製作正確的分析結果。

我們的問題是: 找出資料中高房價的房子所共有的特徵。

- 什麼是高房價?
    - 前 5% 高的房子
- 什麼又是特徵呢?
    - 平均

---

### 定義問題

在開始分析前，好好定義問題有助於製作正確的分析結果。

我們的問題是: 找出資料中高房價的房子所共有的特徵。

- 什麼是高房價?
    - 前 5% 高的房子
- 什麼又是特徵呢?
    - 平均
    - 相關係數
    
---

### 定義問題

在開始分析前，好好定義問題有助於製作正確的分析結果。

我們的問題是: 找出資料中高房價的房子所共有的特徵。

- 什麼是高房價?
    - 前 5% 高的房子
- 什麼又是特徵呢?
    - 平均
    - 相關係數
    - 族繁不及備載

---

### 找出前 5% (10%) 的房價

```{r, cache=TRUE}
quantile(Boston$medv, c(0.95, 0.9))
```

---

### 房價分布圖

- 使用 `hist` 做出房價的柱狀圖。

```{r, cache=TRUE}
hist(Boston$medv, breaks = 20)
```

---

### 房價分布圖

- 使用 `hist` 做出房價的柱狀圖。
- 接著使用 `abline` 標示出剛剛計算的前 5% 高的房價位置。

```{r, cache=TRUE}
hist(Boston$medv, breaks = 20)
abline(v = 43.4, col="red")
```

---

### 平均

- 前 5% 的房子的各項平均與其他房子是否有差異?
- 用 R 簡單計算來看看!

---

### 平均

- 使用 `subset` 做分群。

```{r, cache=TRUE}
MEDVhight = subset(Boston,Boston$medv>=43.4)
MEDVOther = subset(Boston,Boston$medv< 43.4)
# MEDVhight 為房價高的資料
# MEDVOther 其他資料
```

---

### 平均

- 使用 `colMeans` 計算各欄位平均。

```{r, cache=TRUE}
colMeans(MEDVhight)
colMeans(MEDVOther)
```

---

- 使用 `rbind` 合併資料表。

```{r, cache=TRUE}
rbind(colMeans(Boston),colMeans(MEDVhight))
```

---

### 相關係數

- 哪些因素跟房價有正相關或是負相關?
- 用 R 的 `cor` 可以簡單地計算各種相關係數

---

### 相關係數

- 哪些因素跟房價有正相關或是負相關?
- 用 R 的 `cor` 可以簡單地計算各種相關係數

```{r, cache=TRUE}
# 高房價房屋的各欄相關係數
cor(MEDVhight$medv, MEDVhight)
```

---

### 相關係數

- 哪些因素跟房價有正相關或是負相關?
- 用 R 的 `cor` 可以簡單地計算各種相關係數

```{r, cache=TRUE}
# 其他房屋的各欄相關係數
cor(MEDVOther$medv, MEDVOther)
```

---

### 相關係數

- 哪些因素跟房價有正相關或是負相關?
- 用 R 的 `cor` 可以簡單地計算各種相關係數

```{r, cache=TRUE}
# 所有房屋的各欄相關係數。
cor(Boston$medv, Boston)
```

---

- 找出來各種可能會"影響"房價的因子了。

---

- 找出來各種可能會"影響"房價的因子了。
- "影響"又有多"大"呢?

---

### 簡單線性迴歸模型

$$
 Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \epsilon
$$

---

### 簡單線性迴歸模型

$$
 Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \epsilon
$$

<pre>
<font size=6>
# Formula in R
Y ~ X1 + X2
</font>
</pre>

---

### 簡單線性迴歸模型

$$
 Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \epsilon
$$

<pre>
<font size=6>
# R 的 formula 語法，下列與上式等價。
Y ~ X1 + X2
</font>
</pre>

讓我們來看幾個簡單的例子。

---

### 房價 v.s 犯罪率與空氣品質

```{r, cache = TRUE}
fit <- lm(medv ~ crim + nox, data = Boston)
summary(fit)
```

---

### 房價 v.s 犯罪率以外的其他所有因子

```{r, cache = TRUE}
fit <- lm(medv ~ . - crim, data = Boston)
summary(fit)
```


---

### Formula in R

|  符號  |    範例    |              說明                |
---------|------------|----------------------------------|
|    +   |   + crim   | 加入 crim 於模型中。             |
|    -   |   - crim   | 排除 crim 於模型外。             |
|    :   |  crim:dis  | 加入 crim 與 dis 的交乘項。      |
|    1   |   - 1      | 移除截距項。                     |
|   \*   |  crim\*dis | 加入 crim, dis 與其兩者的交乘項。|

[參考資料](http://faculty.chicagobooth.edu/richard.hahn/teaching/FormulaNotation.pdf)


# Chapter 2 資料特性與其意義

---

### 資料集的結構

- 使用 `str` 可以查看 data.frame 的組成結構。

```{r, cache=TRUE}
# 以 Boston 為例。
str(Boston)
```

---

資料就其特性可分為以下幾種：

- 名目資料(nomial)
- 順序資料(ordinal)
- 區間資料(interval)
- 比例資料(ratio)

---

|   | 資料衡量尺度 | 變數形態 |   特性   |
| - |--------------|----------|----------|
| 1 |   名目資料   |   質化   |   類別   |
| 2 |   順序資料   |   質化   | 優先順序 |
| 3 |   區間資料   |   量化   | 大小距離 |
| 4 |   比例資料   |   量化   |   比值   |

---

<h4 style="font-size:45px"> 名目資料 <h4>
數值只用於記號，"值"毫無意義的數據

* 性別
* 國家/班級



男  | 女
------------- | -------------
0  | 1

男  | 女
------------- | -------------
1  | 2

---

<h4 style="font-size:45px"> 順序資料 <h4>
數值有順序關係，但是差距沒有意義
*名次
*排序表
第一名的成績一定比第二名好,
但不代表第一名比第二名好兩倍

![一流大學補助](img/order_example.png)

---

<h4 style="font-size:45px"> 區間資料 <h4>
有差距的概念，沒有倍數的概念。
數值有1的概念，沒有0的概念。可加減。
*溫度
*時間

---

<h4 style="font-size:45px"> 比值資料<h4>
同時有差距和倍數的概念。
可加減乘除。
*使用者人數
*營收

no. | 資料衡量尺度 | 變數形態 | 特性 | Hint
- | - | - | - | -
1 | 名目資料 | 質化 | 類別 | 用於記號,"值"毫無意義的數據
2 | 順序資料 | 質化 | 優先順序 | 有順序關係,但是差距沒有意義
3 | 區間資料 | 量化 | 大小距離 | 數值有順序關係,但是差距沒有意
4 | 比例資料 | 量化 | 比值 | 同時有差距和倍數的概念可加減乘除。

---

<h4 style="font-size:45px"> Factor <h4>

常用於處理質性變數
```{r factor-levels}
x <- c("F","M","F","F")
x
(x <- factor(c("F","M","F","F"), levels=c("F","M")))
levels(x)
as.integer(x)
```

---

<h4 style="font-size:45px"> Factor <h4>

- 咦!? 為什麼會變 `1 2 1 1` 呢?

---

<h4 style="font-size:45px"> Factor <h4>

- 咦!? 為什麼會變 `1 2 1 1` 呢?
- 因為 `factor` 其實是個 `key`-`value` 配對的資料結構。

---

<h4 style="font-size:45px"> Factor <h4>

- 咦!? 為什麼會變 `1 2 1 1` 呢?
- 因為 `factor` 其實是個 `key`-`value` 配對的資料結構。
- 聽不懂沒關係，我們看圖!

---

<h4 style="font-size:45px"> Factor <h4>

![factor](img/Factor.png)


---

<h4 style="font-size:45px"> 向量 <h4>

我要輸入12月份
```{r, cache=TRUE}
Month1=c(1,2,3,4,5,6,7,8,9,10,11,12)
length(Month1)
Month2=1:12
length(Month2)
```

---

R 支援向量加法

```{r, cache=TRUE}
1:3 + 2:4
```

---

R 支援向量加法

```{r, cache=TRUE}
1:3 + 2:4
```

執行 `1:3 + 2:5` 又會怎樣呢? 試試看吧!

---

<h4 style="font-size:45px"> 向量的同質性<h4>

Character > Numeric > Integer > Logical
```{r, cache=TRUE}
x <- c(1, 2, "3")
class(x)
x
```
* 改一個，全部就都變了

---

<h4 style="font-size:45px">異質性資料 List<h4>

```{r, cache=TRUE}
x <- list(1, 2, "3")
x
```

---

放入函數

```{r, cache=TRUE}
x <- list(1, 2, "3", mean) # mean 為內建函數，用於求平均。
x
```

---

<h4 style="font-size:45px">異質性資料 dataframe</h4>

```{r, cache=TRUE}
head(Boston)
```

## R 的資料形別

- 字元 / 字串
- 整數 / 浮點數

## Character

- 最廣泛的資料結構，可用於處理文字相關的工作，如：設定圖片的標題
- 輸入的時候利用`"`或`'`來包覆要輸入的文字

---

### 常用的Character處理函數

字串的剪接：`paste
```{r}
x <- "abc";y <- "dbbbe"
paste(x, y, sep=",")
```

字串的切割：`strsplit`
```{r}
strsplit(x, "b")
```

截取子字串：`substring`
```{r}
name1<-"郭雪芙"
substring(name1, 1, 1)
```

---

練習一下 取出金城武的姓

```{r}
name2<-"金城武"
substring(name2, 1, 2)
```

# 補充資料

---

- [Swirl Courses](https://github.com/swirldev/swirl_courses)  
- [Introduction to R](https://www.datacamp.com/courses/free-introduction-to-r) (around 4 hours) 
- [Cookbook for R](http://www.cookbook-r.com/)

# Acknowlege

---

- Wush

![Wush](img/wush.jpg)

---

- 智程

![Chi-Cheng](https://avatars1.githubusercontent.com/u/3391420?v=3&s=400)
